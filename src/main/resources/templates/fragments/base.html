<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
    <meta charset="UTF-8">
    <title>Fragments</title>
</head>
<body>


<nav th:fragment="navbar(user)" class="navbar fixed-top bg-dark flex-md-nowrap p-0 shadow">
    <p class="navbar-brand col-3 mr-0 mb-0 text-light" th:text="${user.username}"></p>
    <ul class="navbar-nav px-3">
        <li class="text-nowrap">
            <a class="nav-link text-secondary" href="/logout">Выйти</a>
        </li>
    </ul>
</nav>


<nav th:fragment="sidebar(num)" class="col-xl-1 col-md-2 col-auto d-flex d-md-block bg-light">
    <div class="mt-5">
        <ul class="nav flex-wrap">
            <li sec:authorize="hasRole('ADMIN')">
                <a th:href="${num} == 0 ? '#' : '/admin'"
                   th:class="${num} == 0 ? 'nav-link text-primary font-weight-bold' : 'nav-link text-secondary'">
                    Админ
                </a>
            </li>
            <li sec:authorize="hasRole('USER')">
                <a th:href="${num} == 1 ? '#' : '/user'"
                   th:class="${num} == 1 ? 'nav-link text-primary font-weight-bold' : 'nav-link text-secondary'">
                    Пользователь
                </a>
            </li>
        </ul>
    </div>
</nav>


<div th:fragment="table(users)" class="col-md-9 ml-sm-auto col-lg-10 px-4 mt-2 mt-md-5">
    <h2 th:if="${#httpServletRequest.getRequestURI().endsWith('/admin')}">Панель админа</h2>
    <h2 th:if="${#httpServletRequest.getRequestURI().contains('/user')}">Информация о пользователе</h2>

    <div th:if="${#httpServletRequest.getRequestURI().endsWith('/admin')}" class="tabs">
        <input name="mode" type="radio" id="r_users" checked>
        <label for="r_users" onmousedown='return false'>Список пользователей</label>
        <input name="mode" type="radio" id="r_new">
        <label for="r_new" onmousedown='return false'>Новый пользователь</label>

        <div id="tab1" class="table-responsive">
            <h3>Все пользователи</h3>
            <table class="table table-striped table-sm">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Имя</th>
                    <th>Фамилия</th>
                    <th>Возраст</th>
                    <th>Почта</th>
                    <th>Роли</th>
                    <th th:if="${#httpServletRequest.getRequestURI().endsWith('/admin')}"
                        sec:authorize="hasRole('ADMIN')"
                        colspan="2">Действия
                    </th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="u, it : ${users}">
                    <td class="col-1" th:text="${u.id}"></td>
                    <td class="col-2 text-nowrap" th:text="${u.firstName}"></td>
                    <td class="col-2 text-nowrap" th:text="${u.lastName}"></td>
                    <td class="col-1" th:text="${u.getAge()}"></td>
                    <td class="col2 text-nowrap" th:text="${u.username}"></td>
                    <td class="col-sm-2 col-xl-1 text-nowrap" th:text="${u.rolesAsText()}"></td>
                    <td  class="col-1"th:if="${#httpServletRequest.getRequestURI().endsWith('/admin')}"
                        sec:authorize="hasRole('ADMIN')">
                        <a type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal"
                           th:data-bs-target="${'#editModal'+u.id}">Edit</a>
                    </td>
                    <td class="col-1" th:if="${#httpServletRequest.getRequestURI().endsWith('/admin')}"
                        sec:authorize="hasRole('ADMIN')">
                        <a type="button" class="btn btn-sm btn-danger" data-bs-toggle="modal"
                           data-bs-target="#deleteModal" th:data-bs-target="${'#deleteModal'+u.id}">Delete</a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <div id="tab2">
            <h3>Добавить нового пользователя</h3>
        </div>

        <th:block th:each="u : ${users}" th:insert="fragments/modal :: edit(${u})"/>
        <th:block th:each="u : ${users}" th:insert="fragments/modal :: delete(${u})"/>

    </div>
</div>

</body>
</html>
